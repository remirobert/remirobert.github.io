<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>RXSwift Parse request</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,300i,600">
  <link rel="stylesheet" href="/style.css">
  </head>
<body>
  <div class="container">
    <header class="masthead">
  <h1 class="masthead-title--small">
    <a href="/">ðŸ“± Remi</a>
  </h1>
</header>      
<div class="content post">
  <h1 class="post-title">RXSwift Parse request</h1>
  <div class="post-date">
    <time>11 Dec 2015</time>
  </div>
  <p class="lead">How to user <strong>Parse SDK</strong> with <strong>RxSwift</strong></p>

<p>I use <strong>Parse</strong> a lot for my personals projects, or even for hackathons, and some experimentations.
So I know well the <strong>iOS SDK</strong>, than <strong>Parse</strong> provide us, and itâ€™s actually really awesome, and very simple to use ðŸ˜®.
I am currently trying, to write an extension of all SDKâ€™s method, and class, for <strong>RxSwift</strong>, and use <em>reactive programming</em> pattern with <strong>Parse</strong>.
So here, just a very brief example of to make a very simple query throw <strong>RxSwift</strong>.</p>

<h3 id="creating-a-custom-observable">Creating a custom observable</h3>

<p><strong>RxSwift</strong> allows us to create some custom <strong>Observable</strong> very easily.
For this example the idea ðŸ’¡ is just to wrap the Parse request execution, in a <strong>Observable</strong>.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">func</span> <span class="nf">fetchQuerry</span><span class="p">(</span><span class="nv">querry</span><span class="p">:</span> <span class="kt">PFQuery</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Observable</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">PFObject</span><span class="p">]?</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kt">RxSwift</span><span class="o">.</span><span class="nf">create</span><span class="p">({</span> <span class="n">observer</span> <span class="k">in</span>
    <span class="n">querry</span><span class="o">.</span><span class="nf">findObjectsInBackgroundWithBlock</span><span class="p">({</span> <span class="n">objects</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
      <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
        <span class="n">observer</span><span class="o">.</span><span class="nf">onError</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="n">observer</span><span class="o">.</span><span class="nf">onNext</span><span class="p">(</span><span class="n">objects</span><span class="p">)</span>
        <span class="n">observer</span><span class="o">.</span><span class="nf">onCompleted</span><span class="p">()</span>
      <span class="p">}</span>
    <span class="p">})</span>
            
    <span class="k">return</span> <span class="kt">AnonymousDisposable</span> <span class="p">{</span>
      <span class="n">querry</span><span class="o">.</span><span class="nf">cancel</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">})</span>
<span class="p">}</span></code></pre></figure>

<p>And then if we want to call it:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="nv">querry</span> <span class="o">=</span> <span class="kt">PFQuery</span><span class="p">(</span><span class="nv">className</span><span class="p">:</span> <span class="s">"Good"</span><span class="p">)</span>
        
<span class="nf">fetchQuerry</span><span class="p">(</span><span class="n">querry</span><span class="p">)</span><span class="o">.</span><span class="n">subscribe</span> <span class="p">{</span> <span class="n">event</span> <span class="k">in</span>
  <span class="k">switch</span> <span class="n">event</span> <span class="p">{</span>
  <span class="k">case</span> <span class="o">.</span><span class="kt">Next</span><span class="p">(</span><span class="k">let</span> <span class="nv">objects</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"objects fetched : </span><span class="se">\(</span><span class="n">objects</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
  <span class="k">case</span> <span class="o">.</span><span class="kt">Error</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"error: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
  <span class="k">case</span> <span class="o">.</span><span class="kt">Completed</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"completed"</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span><span class="o">.</span><span class="nf">addDisposableTo</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">disposeBag</span><span class="p">)</span></code></pre></figure>

<p><strong>Parse</strong> uses currently the <strong>Bolts</strong> framework, which is very awsome, to manage <em>async operation</em>. 
So thatâ€™s why, using <strong>RxSwift</strong> here is not the best way to do, but only a matter of design. 
An example how to combine several requests, and then combine the fetched datas, in a very extremely easy example:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kt">RxSwift</span><span class="o">.</span><span class="nf">combineLatest</span><span class="p">(</span><span class="nf">fetchQuerry</span><span class="p">(</span><span class="n">querry</span><span class="p">),</span> <span class="nf">fetchQuerry</span><span class="p">(</span><span class="n">querry</span><span class="p">))</span> <span class="p">{</span> <span class="p">(</span><span class="n">goods1</span><span class="p">,</span> <span class="n">goods2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">PFObject</span><span class="p">]</span> <span class="k">in</span>
  <span class="k">var</span> <span class="nv">combineGoods</span> <span class="o">=</span> <span class="p">[</span><span class="kt">PFObject</span><span class="p">]()</span>
  <span class="k">if</span> <span class="k">let</span> <span class="nv">goods1</span> <span class="o">=</span> <span class="n">goods1</span> <span class="p">{</span>
    <span class="n">combineGoods</span><span class="o">.</span><span class="nf">appendContentsOf</span><span class="p">(</span><span class="n">goods1</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="k">let</span> <span class="nv">goods2</span> <span class="o">=</span> <span class="n">goods2</span> <span class="p">{</span>
    <span class="n">combineGoods</span><span class="o">.</span><span class="nf">appendContentsOf</span><span class="p">(</span><span class="n">goods2</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">combineGoods</span>
 <span class="p">}</span><span class="o">.</span><span class="n">subscribeNext</span> <span class="p">{</span> <span class="n">finalObjects</span> <span class="k">in</span>
  <span class="nf">print</span><span class="p">(</span><span class="s">"combined objects : </span><span class="se">\(</span><span class="n">finalObjects</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span><span class="o">.</span><span class="nf">addDisposableTo</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">disposeBag</span><span class="p">)</span></code></pre></figure>

<p>So far as we have a <strong>Observable</strong>, we do everything, can be an awsome wrapper for the <strong>Parse SDK</strong>, with a great design.</p>

</div>

  </div>
</body>
</html>
